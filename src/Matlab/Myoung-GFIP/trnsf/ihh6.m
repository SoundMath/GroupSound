function y=ihh6(x,gp)
% n must be a multiple of 3
[n,tem]=size(x);
n2=n+n;
n3=n2+n;
n4=n3+n;
n5=n4+n;
n6=n5+n;
nd3=n/3;
nd2=n/2;
y=x;
%
if (gp==1) % sdp [0 1; -1 1]
   d1=1;
   c1(1,1)=1;
   c1(2,1)=1;
   d2=2;
   c2(1,1)=nd3+1;
   c2(2,1)=2*nd3+1;
   c2(1,2)=2*nd3+1;
   c2(2,2)=nd3+1;
   d3=3;
   c3(1,1)=1;
   c3(2,1)=nd2+1;
   c3(1,2)=nd2+1;
   c3(2,2)=1;
   c3(1,3)=nd2+1;
   c3(2,3)=nd2+1;
end   
%
if (gp==2) % [0 -1; 1 1]
   d1=1;
   c1(1,1)=1;
   c1(2,1)=1;
   d2=2;
   c2(1,1)=nd3+1;
   c2(2,1)=nd3+1;
   c2(1,2)=2*nd3+1;
   c2(2,2)=2*nd3+1;
   d3=3;
   c3(1,1)=1;
   c3(2,1)=nd2+1;
   c3(1,2)=nd2+1;
   c3(2,2)=1;
   c3(1,3)=nd2+1;
   c3(2,3)=nd2+1;
end   
%
if (gp==3 & rem(n/3,4)==0) % [-1 n/3+1;n/3-1 n/3]
   d1=3;
   c1(1,1)=1;
   c1(2,1)=1;
   c1(1,2)=nd3+1;
   c1(2,2)=nd3+1;
   c1(1,3)=2*nd3+1;
   c1(2,3)=2*nd3+1;
   d2=6;
   c2(1,1)=1;
   c2(2,1)=nd3+1;
   c2(1,2)=1;
   c2(2,2)=2*nd3+1;
   c2(1,3)=nd3+1;
   c2(2,3)=1;
   c2(1,4)=nd3+1;
   c2(2,4)=2*nd3+1;
   c2(1,5)=2*nd3+1;
   c2(2,5)=1;
   c2(1,6)=2*nd3+1;
   c2(2,6)=nd3+1;
   d3=n*nd3;
   for k1=0:n-1
      kk=rem(k1,3);
      for k2=0:nd3-1
         c3(1,1+k2+nd3*k1)=1+k1;
         c3(2,1+k2+nd3*k1)=1+kk+3*k2;
      end   
   end   
end   
if (gp==3 & rem(n/3,4)==2) % [-1 n/3+1;n/3-1 n/3]
   d1=1;
   c1(1,1)=1;
   c1(2,1)=1;
   d2=2;
   c2(1,1)=1;
   c2(2,1)=nd3;
   c2(1,2)=1;
   c2(2,2)=2*nd3+1;
   d3=nd3*nd3;
   for k1=0:nd3-1
      for k2=0:nd3-1
         c3(1,1+k2+nd3*k1)=1+3*k1;
         c3(2,1+k2+nd3*k1)=1+3*k2;
      end   
   end   
end   
%
if (gp==4 & rem(n/3,4)==0) % [n/2-1 n/3-1;n/3+1 n/3];
   d1=3;
   c1(1,1)=1;
   c1(2,1)=1;
   c1(1,2)=1;
   c1(2,2)=nd3+1;
   c1(1,3)=1;
   c1(2,3)=2*nd3+1;
   d2=6;
   c2(1,1)=nd3+1;
   c2(2,1)=1;
   c2(1,2)=nd3+1;
   c2(2,2)=nd3+1;
   c2(1,3)=nd3+1;
   c2(2,3)=2*nd3+1;
   c2(1,4)=2*nd3+1;
   c2(2,4)=1;
   c2(1,5)=2*nd3+1;
   c2(2,5)=nd3+1;
   c2(1,6)=2*nd3+1;
   c2(2,6)=2*nd3+1;
   d3=n*n/12;
   for k1=0:n/6-1
      for k2=0:n/2-1
         c3(1,1+k2+(n/2)*k1)=6*k1+1;
         c3(2,1+k2+(n/2)*k1)=2*k2+1;
      end
   end   
end
if (gp==4 & rem(n/3,4)==0) % [n/2-1 n/3-1;n/3+1 n/3];
   d1=1;
   c1(1,1)=1;
   c1(2,1)=1;
   d2=2;
   c2(1,1)=nd3+1;
   c2(2,1)=1;
   c2(1,2)=2*nd3+1;
   c2(2,2)=1;
   d3=(n/6)*(n/6)
   for k1=0:n/6-1
      for k2=0:n/6-1
         c3(1,1+k2+(n/6)*k1)=6*k1+1;
         c3(2,1+k2+(n/6)*k1)=6*k2+1;
      end
   end      
end
%
%
%
for k=1:d3
   t3(1,k)=x(c3(1,k),c3(2,k));
   t3(2,k)=x(c3(1,k),c3(2,k)+n3);
   s3(1,k)=x(c3(1,k),c3(2,k)+n);
   s3(2,k)=x(c3(1,k),c3(2,k)+n4);
   r3(1,k)=x(c3(1,k),c3(2,k)+n2);
   r3(2,k)=x(c3(1,k),c3(2,k)+n5);
end
t3=(1/sqrt(2))*fft(t3);
s3=(1/sqrt(2))*fft(s3);
r3=(1/sqrt(2))*fft(r3);
for k=1:d3
   y(c3(1,k),c3(2,k))=t3(1,k);
   y(c3(1,k),c3(2,k)+n3)=t3(2,k);
   y(c3(1,k),c3(2,k)+n)=s3(1,k);
   y(c3(1,k),c3(2,k)+n4)=s3(2,k);
   y(c3(1,k),c3(2,k)+n2)=r3(1,k);
   y(c3(1,k),c3(2,k)+n5)=r3(2,k);
end
for k=1:d2
   t2(1,k)=x(c2(1,k),c2(2,k));
   t2(2,k)=x(c2(1,k),c2(2,k)+n2);
   t2(3,k)=x(c2(1,k),c2(2,k)+n4);
   s2(1,k)=x(c2(1,k),c2(2,k)+n);
   s2(2,k)=x(c2(1,k),c2(2,k)+n3);
   s2(3,k)=x(c2(1,k),c2(2,k)+n5);
end   
t2=(1/sqrt(3))*fft(t2);
s2=(1/sqrt(3))*fft(s2);
for k=1:d2
   k1=c2(1,k);
   k2=c2(2,k);
   y(k1,k2)=t2(1,k);
   y(k1,k2+n2)=t2(2,k);
   y(k1,k2+n4)=t2(3,k);
   y(k1,k2+n)=s2(1,k);
   y(k1,k2+n3)=s2(2,k);
   y(k1,k2+n5)=s2(3,k);
end
for k=1:d1
   t1(1,k)=x(c1(1,k),c1(2,k));
   t1(2,k)=x(c1(1,k),c1(2,k)+n);
   t1(3,k)=x(c1(1,k),c1(2,k)+n2);
   t1(4,k)=x(c1(1,k),c1(2,k)+n3);
   t1(5,k)=x(c1(1,k),c1(2,k)+n4);
   t1(6,k)=x(c1(1,k),c1(2,k)+n5);
end   
t1=(1/sqrt(6))*fft(t1);
for k=1:d1
   y(c1(1,k),c1(2,k))=t1(1,k);
   y(c1(1,k),c1(2,k)+n)=t1(2,k);
   y(c1(1,k),c1(2,k)+n2)=t1(3,k);
   y(c1(1,k),c1(2,k)+n3)=t1(4,k);
   y(c1(1,k),c1(2,k)+n4)=t1(5,k);
   y(c1(1,k),c1(2,k)+n5)=t1(6,k);
end   
%
%
for k=1:6
   y(1:n,1+(k-1)*n:k*n)=(1/n)*fft2(y(1:n,1+(k-1)*n:k*n));
end